<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nestedLogit">
<title>Plotting nestedLogit models • nestedLogit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting nestedLogit models">
<meta property="og:description" content="nestedLogit">
<meta property="og:image" content="http://friendly.github.io/nestedLogit/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nestedLogit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nestedLogit.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/plotting.html">Plotting nestedLogit models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/friendly/nestedLogit/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Plotting nestedLogit models</h1>
                        <h4 data-toc-skip class="author">Michael
Friendly and John Fox</h4>
            
            <h4 data-toc-skip class="date">2023-05-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/friendly/nestedLogit/blob/HEAD/vignettes/plotting.Rmd" class="external-link"><code>vignettes/plotting.Rmd</code></a></small>
      <div class="d-none name"><code>plotting.Rmd</code></div>
    </div>

    
    
<p>Load the packages we’ll use here:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/nestedLogit" class="external-link">nestedLogit</a></span><span class="op">)</span>    <span class="co"># Nested Dichotomy Logistic Regression Models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>          <span class="co"># A General-Purpose Package for Dynamic Report Generation in R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>          <span class="co"># A Grammar of Data Manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>          <span class="co"># Tidy Messy Data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>        <span class="co"># Create Elegant Data Visualisations Using the Grammar of Graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allancameron.github.io/geomtextpath/" class="external-link">geomtextpath</a></span><span class="op">)</span>   <span class="co"># Curved Text in 'ggplot2'</span></span></code></pre></div>
<p>The main vignette illustrated the basic plot method,
<code><a href="../reference/plot.nestedLogit.html">plot.nestedLogit()</a></code> in the package. However, to explain
plotting nested-dichotomies models works, and for better control of the
details, it is useful to describe how graphs can be constructed directly
directly. We’ll use the same example of women’s labor force
participation, using the original dichotomies:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Womenlf</span>, package <span class="op">=</span> <span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="va">Womenlf</span><span class="op">$</span><span class="va">partic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Womenlf</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">partic</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not.work"</span>, <span class="st">"parttime"</span>, <span class="st">"fulltime"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wlf.nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nestedLogit.html">nestedLogit</a></span><span class="op">(</span><span class="va">partic</span> <span class="op">~</span> <span class="va">hincome</span> <span class="op">+</span> <span class="va">children</span>,</span>
<span>                          dichotomies <span class="op">=</span> <span class="fu"><a href="../reference/nestedLogit.html">logits</a></span><span class="op">(</span>work<span class="op">=</span><span class="fu"><a href="../reference/nestedLogit.html">dichotomy</a></span><span class="op">(</span><span class="st">"not.work"</span>, working<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"parttime"</span>, <span class="st">"fulltime"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                               full<span class="op">=</span><span class="fu"><a href="../reference/nestedLogit.html">dichotomy</a></span><span class="op">(</span><span class="st">"parttime"</span>, <span class="st">"fulltime"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          data<span class="op">=</span><span class="va">Womenlf</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="fitted-probabilities">Fitted probabilities<a class="anchor" aria-label="anchor" href="#fitted-probabilities"></a>
</h2>
<p>To draw a plot, it is sufficient to calculate predicted probabilities
over a grid of values of the predictor variables. Here, we select a
range of 0 - 45 in steps of 5, combined with the two values of
<code>children</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>hincome<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">45</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                   children<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"absent"</span>, <span class="st">"present"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred.nested</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">wlf.nested</span>, newdata <span class="op">=</span> <span class="va">new</span><span class="op">)</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">new</span>, <span class="va">pred.nested</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   hincome children not.work parttime fulltime</span></span>
<span><span class="co">#&gt; 1       0   absent   0.2082  0.02372   0.7681</span></span>
<span><span class="co">#&gt; 2       5   absent   0.2452  0.03785   0.7169</span></span>
<span><span class="co">#&gt; 3      10   absent   0.2864  0.05907   0.6545</span></span>
<span><span class="co">#&gt; 4      15   absent   0.3315  0.08936   0.5791</span></span>
<span><span class="co">#&gt; 5      20   absent   0.3800  0.12944   0.4906</span></span>
<span><span class="co">#&gt; 6      25   absent   0.4309  0.17691   0.3922</span></span></code></pre></div>
<div class="section level3">
<h3 id="using-matplot">Using <code>matplot()</code><a class="anchor" aria-label="anchor" href="#using-matplot"></a>
</h3>
<p>Because the fitted values are in multiple columns, it is easiest to
plot these using <code><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot()</a></code>. We could plot these all in a
single (messy) figure, but it is clearer to show separate panels for
children <code>absent</code> and <code>present</code>.</p>
<p>To do this, the <code>plotdata</code> data set is subset within a
loop over the values of <code>children</code> and each subset is plotted
by <code>matplot</code>. It is only necessary to include the legend in
one panel. The plots are combined into a single figure using
<code>par(mfrow())</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"magenta"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">kids</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"absent"</span>, <span class="st">"present"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">plotdata</span>, <span class="va">children</span><span class="op">==</span><span class="va">kids</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="st">"hincome"</span><span class="op">]</span>, <span class="va">data</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, </span>
<span>          type <span class="op">=</span> <span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, col <span class="op">=</span> <span class="va">cols</span>,</span>
<span>          xlab<span class="op">=</span><span class="st">"Husband's Income"</span>, </span>
<span>          ylab<span class="op">=</span><span class="st">'Fitted Probability'</span>,</span>
<span>          main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Children"</span>, <span class="va">kids</span><span class="op">)</span>,</span>
<span>          cex.lab <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">kids</span><span class="op">==</span><span class="st">"absent"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="va">cols</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>           legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fulltime"</span>, <span class="st">"parttime"</span>, <span class="st">"not working"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/wlf-matplot-1.png" alt="**matplot**: Predicted probabilities of working at all or working part time or full time" width="100%"><p class="caption">
<strong>matplot</strong>: Predicted probabilities of working at all or
working part time or full time
</p>
</div>
</div>
<div class="section level3">
<h3 id="using-ggplot">Using <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#using-ggplot"></a>
</h3>
<p>More control, and perhaps a more aesthetically pleasing figure can be
produced using <code>ggplot</code> <span class="citation">(Wickham et
al., 2023)</span>. However, <code>ggplot</code> wants the data in long
format. That makes it easy to plot probability against one predictor and
use <code>color</code> to distinguish the levels of <code>partic</code>
and facet the plot by <code>children</code>. (The result of
<code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">tidyr::pivot_longer()</a></code> doesn’t recognize an ordered nature
of <code>"Working"</code>, so this is done in a separate step.)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotlong</span> <span class="op">&lt;-</span> <span class="va">plotdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">fulltime</span> <span class="op">:</span> <span class="va">not.work</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"Working"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Working <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">Working</span>, </span>
<span>                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not.work"</span>, <span class="st">"parttime"</span>, <span class="st">"fulltime"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plotlong</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   hincome children Working  Probability</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       0 absent   fulltime      0.768 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       0 absent   parttime      0.023<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       0 absent   not.work      0.208 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       5 absent   fulltime      0.717 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5 absent   parttime      0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>       5 absent   not.work      0.245</span></span></code></pre></div>
<p>Then, one call to <code>ggplot</code> produces both panels. To sort
the levels of <code>Working</code> appropriately, we made this an
ordered factor in the step above, but assign the colors with a discrete
scale.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotlong</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hincome</span>, y<span class="op">=</span><span class="va">Probability</span>, color<span class="op">=</span><span class="va">Working</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Husband's Income"</span>, y<span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">children</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/wlf-ggplot-1.png" alt="**ggplot**: Predicted probabilities of working at all or working part time or full time" width="100%"><p class="caption">
<strong>ggplot</strong>: Predicted probabilities of working at all or
working part time or full time
</p>
</div>
</div>
<div class="section level3">
<h3 id="direct-labels">Direct labels<a class="anchor" aria-label="anchor" href="#direct-labels"></a>
</h3>
<p>It’s usually nicer to label the curves directly than to rely on a
legend. The <code>geomtextpath</code> <span class="citation">(<strong>R-geomtextpath?</strong>)</span> package
offers <code><a href="https://allancameron.github.io/geomtextpath/reference/geom_textpath.html" class="external-link">geom_textline()</a></code> as an alternative to
<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code> that adds a text label to a curve.
<code>hjust</code> and <code>vjust</code> position the labels along the
curve.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotlong</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hincome</span>, y<span class="op">=</span><span class="va">Probability</span>, color<span class="op">=</span><span class="va">Working</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://allancameron.github.io/geomtextpath/reference/geom_textpath.html" class="external-link">geom_textline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">Working</span><span class="op">)</span>,</span>
<span>                linewidth <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                hjust <span class="op">=</span> <span class="fl">0.9</span>, vjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Husband's Income"</span>, y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">children</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/wlf-geomtextpath-1.png" alt="**geomtextpath**: Predicted probabilities, with labels on the curves" width="100%"><p class="caption">
<strong>geomtextpath</strong>: Predicted probabilities, with labels on
the curves
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plotting-fitted-log-odds">Plotting fitted log odds<a class="anchor" aria-label="anchor" href="#plotting-fitted-log-odds"></a>
</h2>
<!-- Michael: Maybe move this to a separate vignette? -->
<p>It is sometimes easier to interpret logistic regression models by
plotting the linear predictors on the <strong>log odds</strong> scale,
because these appear as straight lines. That is, from the estimated
coefficients in the model, the predicted log odds of <code>work</code>
and <code>full</code> are given by <!-- TODO: cite equatiomatic -->
<!-- equatiomatic::extract_eq(wlf.nested$models[[1]], use_coefs = TRUE) -->
<!-- equatiomatic::extract_eq(wlf.nested$models[[2]], use_coefs = TRUE) --></p>
<p><span class="math display">\[
L_1 =\log\left[ \frac { \widehat{P( \operatorname{work} =
\operatorname{1} )} }{ 1 - \widehat{P( \operatorname{work} =
\operatorname{1} )} } \right] = 1.34 - 0.04(\operatorname{hincome}) -
1.58(\operatorname{children}_{\operatorname{present}})
\]</span></p>
<p><span class="math display">\[
L_2 =\log\left[ \frac { \widehat{P( \operatorname{full} =
\operatorname{1})} }{ 1 - \widehat{P( \operatorname{full} =
\operatorname{1})} } \right] = 3.48 - 0.11(\operatorname{hincome}) -
2.65(\operatorname{children}_{\operatorname{present}})
\]</span> Here, <span class="math inline">\(\operatorname{children}_{\operatorname{present}}\)</span>
is either 0 or 1, so this amounts to a shift in the intercept when
children are present.</p>
<p>These values can be calculated by calling <code><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm()</a></code>
directly for the <code>models</code> component of
<code>wlf.nested</code>, specifying <code>type = "link"</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.logits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="va">wlf.nested</span><span class="op">)</span>, <span class="va">predict</span>, newdata<span class="op">=</span><span class="va">new</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="va">plotdatal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">new</span>, <span class="va">pred.logits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plotdatal</span><span class="op">)</span></span>
<span><span class="co">#&gt;   hincome children   work   full</span></span>
<span><span class="co">#&gt; 1       0   absent 1.3358 3.4778</span></span>
<span><span class="co">#&gt; 2       5   absent 1.1243 2.9414</span></span>
<span><span class="co">#&gt; 3      10   absent 0.9127 2.4051</span></span>
<span><span class="co">#&gt; 4      15   absent 0.7012 1.8688</span></span>
<span><span class="co">#&gt; 5      20   absent 0.4897 1.3324</span></span>
<span><span class="co">#&gt; 6      25   absent 0.2781 0.7961</span></span></code></pre></div>
<p>Then we plot these more or less as before:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">.1</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">kids</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"absent"</span>, <span class="st">"present"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">plotdatal</span>, <span class="va">children</span><span class="op">==</span><span class="va">kids</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="st">"hincome"</span><span class="op">]</span>, <span class="va">data</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>          type <span class="op">=</span> <span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">3</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">cols</span>,</span>
<span>          xlab<span class="op">=</span><span class="st">"Husband's Income"</span>,</span>
<span>          ylab<span class="op">=</span><span class="st">'Predicted Log Odds'</span>,</span>
<span>          main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Children"</span>, <span class="va">kids</span><span class="op">)</span>,</span>
<span>          cex.lab <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">kids</span><span class="op">==</span><span class="st">"absent"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="va">cols</span>, bty <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>           title <span class="op">=</span> <span class="st">"Dichotomy"</span>,</span>
<span>           legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"work"</span>, <span class="st">"full"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/wlf-logits-1.png" alt="**log odds**: Predicted logits of the  `work` and `full` dichotomies, by `children`" width="100%"><p class="caption">
<strong>log odds</strong>: Predicted logits of the <code>work</code> and
<code>full</code> dichotomies, by <code>children</code>
</p>
</div>
<p>Finally, we can use <code>ggplot</code> as before to plot the fitted
logits, first transforming the long format.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotlongl</span> <span class="op">&lt;-</span> <span class="va">plotdatal</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">work</span> <span class="op">:</span> <span class="va">full</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"Dichotomy"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Dichotomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">Dichotomy</span>,</span>
<span>                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"work"</span>, <span class="st">"full"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<p>Doing this gives the flexibility that we can facet the plot either by
<code>children</code> (as before) or <code>Dichotomy</code>. The latter
nicely shows that the additive model has equal slopes for husband’s
income within both panels: increasing husband’s income decreases the log
odds of working, but at a faster rate for the <code>full</code>
dichotomy. Having young children decreases the log odds of working
either at all or working fulltime as compared to parttime.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plotlongl</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">hincome</span>, y<span class="op">=</span><span class="va">logit</span>, color<span class="op">=</span><span class="va">children</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span>, shape <span class="op">=</span> <span class="fl">16</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Husband's Income"</span>, y<span class="op">=</span> <span class="st">"Log Odds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Dichotomy</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.35</span>, <span class="fl">.82</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/wlf-gglogits-1.png" alt="**log odds**: Predicted logits of the  `work` and `full` dichotomies, by `Dichotomy`" width="100%"><p class="caption">
<strong>log odds</strong>: Predicted logits of the <code>work</code> and
<code>full</code> dichotomies, by <code>Dichotomy</code>
</p>
</div>
<!-- Can't do it this way as that would clobber the one written by the other vignette. -->
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-R-ggplot2" class="csl-entry">
Wickham, H., Chang, W., Henry, L., Pedersen, T. L., Takahashi, K.,
Wilke, C., … Dunnington, D. (2023). <em>ggplot2: Create elegant data
visualisations using the grammar of graphics</em>. Retrieved from <a href="https://CRAN.R-project.org/package=ggplot2" class="external-link">https://CRAN.R-project.org/package=ggplot2</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John Fox, Michael Friendly.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
