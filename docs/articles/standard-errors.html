<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nestedLogit">
<title>Standard Errors of Fitted Category Probabilities by the Delta Method for the Nested Logit Model • nestedLogit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Standard Errors of Fitted Category Probabilities by the Delta Method for the Nested Logit Model">
<meta property="og:description" content="nestedLogit">
<meta property="og:image" content="http://friendly.github.io/nestedLogit/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nestedLogit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nestedLogit.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/plotting-ggplot.html">Plotting nestedLogit models with ggplot2</a>
    <a class="dropdown-item" href="../articles/standard-errors.html">Standard Errors of Fitted Category Probabilities by the Delta Method for the Nested Logit Model</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/friendly/nestedLogit/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Standard Errors of Fitted Category Probabilities by the Delta Method for the Nested Logit Model</h1>
                        <h4 data-toc-skip class="author">John Fox</h4>
            
            <h4 data-toc-skip class="date">2023-05-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/friendly/nestedLogit/blob/HEAD/vignettes/standard-errors.Rmd" class="external-link"><code>vignettes/standard-errors.Rmd</code></a></small>
      <div class="d-none name"><code>standard-errors.Rmd</code></div>
    </div>

    
    
<!-- \usepackage{amsmath} -->
<p>This document uses the delta method <span class="citation">(Fox,
2021, sec. 6.3.5)</span> to derive approximations to the variances of
estimated probabilities for dichotomous logit models, and from these,
for the nested logit model. The standard errors of these estimated
probabilities are the square-roots of their respective variances.</p>
<div class="section level2">
<h2 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h2>
<p>Let <span class="math inline">\(\psi_j\)</span> represent the
probability that the dichotomous response in the <span class="math inline">\(j\)</span>th nested dichotomous logit model is
<span class="math inline">\(Y_j = 1\)</span> (i.e., a “success”), <span class="math inline">\(j = 1, \ldots, m - 1\)</span>, where <span class="math inline">\(m\)</span> is the number of response categories
for the polytomy. Then <span class="math inline">\(1 - \psi_j\)</span>
is the probability that <span class="math inline">\(Y_j = 0\)</span>
(i.e., a “failure”). I assume that the regression coefficients and their
covariance matrix for each dichotomous logit model are estimated in the
usual manner.</p>
<p>Let <span class="math inline">\(\lambda_j = \log[\psi_j/(1 -
\psi_j]\)</span> represent the (estimated) logit (log-odds) for the
<span class="math inline">\(j\)</span>th dichotomous logit model, with
variance <span class="math inline">\(V(\lambda_j)\)</span> (see
below).</p>
<p>Let <span class="math inline">\(\phi_k\)</span>, <span class="math inline">\(k = 1, \ldots, m\)</span> represent the
probability that the polytomous response is <span class="math inline">\(Y = k\)</span>.</p>
<p>Let <span class="math inline">\(\widehat{\psi}_{j}\)</span> and <span class="math inline">\(\widehat{\phi}_k\)</span> represent the estimates
of these probabilities.</p>
<p>In the sequel, which involves only the estimates of these and other
parameters, I’ll omit the hats so as to simplify the notation.</p>
<p>In the nested logit model, the polytomous probabilities <span class="math inline">\(\phi_k\)</span> are each products of probabilities
<span class="math inline">\(\psi_j\)</span> or <span class="math inline">\(1 - \psi_j\)</span> for <span class="math inline">\(j \in \mathcal{M}_k \subseteq \left\{ 1, \ldots, m
- 1 \right\}\)</span>; that is <span class="math inline">\(\mathcal{M}_k\)</span> is the subset of the
dichotomous logit models that enter into <span class="math inline">\(\phi_k\)</span>. Let <span class="math inline">\(\psi_{j, k_j}\)</span> represent either <span class="math inline">\(\psi_j\)</span> or <span class="math inline">\(1 -
\psi_j\)</span>, as appropriate for category <span class="math inline">\(k\)</span> of the polytomous response. Then <span class="math display">\[\begin{equation*}
\phi_k = \prod_{j \in \mathcal{M}_k} \psi_{j,k_j}
\end{equation*}\]</span> for <span class="math inline">\(k = 1, \ldots,
m\)</span>.</p>
<p>Finally, the individual-category probabilities <span class="math inline">\(\phi_k\)</span> can be converted into logits,
<span class="math inline">\(\Lambda_k = \log[\phi_k/(1 -
\phi_k)]\)</span>. The estimates of these logits should approach
asymptotic normality more rapidly than the estimates of the
corresponding probabilities.</p>
<div class="section level3">
<h3 id="an-example">An Example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h3>
<p>I’ll use the following example to illustrate the results in this
document: Suppose that we have a three-category response variable <span class="math inline">\(Y\)</span> with categories <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span>, and define the two nested dichotomies
<span class="math inline">\(Y_1\)</span> coded 0 or 1 for categories
<span class="math inline">\(\{A\}\)</span> and <span class="math inline">\(\{B, C\}\)</span>, respectively, and <span class="math inline">\(Y_2\)</span> coded 0 and 1 for categories <span class="math inline">\(\{B\}\)</span> and <span class="math inline">\(\{C\}\)</span>. Then <span class="math inline">\(\psi_1 = \Pr(Y_1 = 1) = \Pr(\{B, C\})\)</span>;
<span class="math inline">\(1 - \psi_1 = \Pr(Y_1 = 0) =
\Pr(\{A\})\)</span>. As well, <span class="math inline">\(\mathcal{M}_A
= \{1\}\)</span> and <span class="math inline">\(\mathcal{M}_B =
\mathcal{M}_C = \{1, 2\}\)</span>. Consequently, <span class="math display">\[\begin{align*}
    \phi_A &amp;= \psi_{1, A_1} = 1 - \psi_{1}\\
    \phi_B &amp;= \psi_{1, B_1}\psi_{2, B_2} = \psi_{1}(1 - \psi_{2}) \\
    \phi_C &amp;= \psi_{1, C_1}\psi_{2, C_2} = \psi_{1}\psi_{2}
\end{align*}\]</span> Here, I abuse the notation slightly in the
interest of clarity, using letters rather than numbers for the response
categories, so the index of response categories, <span class="math inline">\(k\)</span>, takes on the values <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span>, rather than 1, 2, and 3.</p>
</div>
</div>
<div class="section level2">
<h2 id="variances-of-the-estimated-probabilities">Variances of the Estimated Probabilities<a class="anchor" aria-label="anchor" href="#variances-of-the-estimated-probabilities"></a>
</h2>
<div class="section level3">
<h3 id="for-the-dichotomous-logit-models">For the Dichotomous Logit Models<a class="anchor" aria-label="anchor" href="#for-the-dichotomous-logit-models"></a>
</h3>
<p>The estimated probability of success <span class="math inline">\(\psi_{j}\)</span> for the <span class="math inline">\(j\)</span>th dichotomous logit model is <span class="math display">\[\begin{equation*}
\psi_{j} = \frac{1}{1 + e^{-\lambda_{j}}}
\end{equation*}\]</span> Then <span class="math display">\[\begin{align*}
    \lambda_{j} &amp;= \alpha^{(j)} + \beta_1^{(j)} x_1 + \cdots +
\beta_p^{(j)} x_p \\
    &amp;= \mathbf{x}^T \boldsymbol{\beta}^{(j)}
\end{align*}\]</span> is a function of the regression coefficients,
where <span class="math inline">\(\mathbf{x}^T = [1, x_1, \ldots,
x_p]\)</span> (an arbitrary vector of values of the regressors) and
<span class="math inline">\(\boldsymbol{\beta}^{(j)} = [\alpha^{(j)},
\beta_1^{(j)}, \ldots, \beta_p^{(j)}]^T\)</span>. The probability of
failure is <span class="math display">\[\begin{equation*}
1 - \psi_{j} = \frac{1}{1 + e^{\lambda_{j}}}
\end{equation*}\]</span> The variance of the logit is <span class="math inline">\(V(\lambda_{j}) = \mathbf{x}^T
V(\boldsymbol{\beta}^{(j)}) \mathbf{x}\)</span>,</p>
<p>The derivatives of <span class="math inline">\(\psi_{j}\)</span> and
<span class="math inline">\(1 - \psi_{j}\)</span> with respect to <span class="math inline">\(\lambda_{j}\)</span> are <span class="math display">\[\begin{align*}
\frac{d\psi_{j}}{d\lambda_{j}} &amp;= \frac{e^{-\lambda_{j}}}{\left( 1 +
e^{-\lambda_{j}} \right)^2} \\
\frac{d \left(1 - \psi_{j} \right)}{d\lambda_{j}} &amp;= -
\frac{e^{\lambda_{j}}}{\left( 1 + e^{\lambda_{j}} \right)^2}
\end{align*}\]</span></p>
<p>By the univariate delta method, <span class="math display">\[\begin{align*}
V(\psi_{j}) &amp;\approx \left( \frac{d\psi_{j}}{d\lambda_{j}} \right)^2
V(\lambda_{j}) \\
&amp;= \left[ \frac{e^{-\lambda_{j}}}{\left( 1 + e^{-\lambda_{j}}
\right)^2} \right]^2 V(\lambda_{j})\\
V(1 - \psi_{j}) &amp;\approx \left[ \frac{d \left(1 - \psi_{j}
\right)}{d\lambda_{j}} \right]^2 V(\lambda_{j}) \\
&amp;= \left[ \frac{e^{\lambda_{j}}}{\left( 1 + e^{\lambda_{j}}
\right)^2}\right]^2 V(\lambda_{j}) \\
&amp;= V(\psi_{j})
\end{align*}\]</span></p>
</div>
<div class="section level3">
<h3 id="for-the-nested-logit-model">For the Nested Logit Model<a class="anchor" aria-label="anchor" href="#for-the-nested-logit-model"></a>
</h3>
<p>The variances of the estimated response-category probabilities for
the polytomous response can be obtained similarly by the multivariate
delta method, recognizing that these probabilities are products of the
dichotomous probabilities. The result is greatly simplified because the
dichotomies are independent, and so the covariance matrix of the
estimated dichotomous probabilities is diagonal.</p>
<p>The required derivatives are <span class="math display">\[\begin{equation*}
\frac{\partial \phi_k}{\partial \psi_{j, k_j} } = \prod_{j' \in
\mathcal{M}_k - \{j\}} \psi_{j', k_j}
\end{equation*}\]</span> for <span class="math inline">\(j \in
\mathcal{M}_k\)</span> and <span class="math inline">\(k = 1, \ldots,
m\)</span>. Here, <span class="math inline">\(-\)</span> denotes set
difference. Because <span class="math inline">\(V(\psi_{j}) = V(1 -
\psi_{j})\)</span>, it’s always the case that <span class="math inline">\(V(\psi_{j, k_j}) = V(\psi_{j})\)</span>, and so
<span class="math display">\[\begin{align*}
V(\phi_k) &amp;\approx \sum_{j \in \mathcal{M}_k} \left( \frac{\partial
\phi_k}{\partial \psi_{j, k_j} }  \right)^2 V\left( \psi_{j} \right) \\
&amp;= \sum_{j \in \mathcal{M}_k} \left( \prod_{j' \in \mathcal{M}_k
- \{j\}} \psi_{j', k_j} \right)^2 V\left( \psi_{j} \right)
\end{align*}\]</span> for <span class="math inline">\(k = 1, \ldots,
m\)</span>.</p>
<p>Applying these results to the example, recall, first, that <span class="math inline">\(\mathcal{M}_A = \{1\}\)</span> and so the set for
the product <span class="math inline">\(\prod_{j' \in
\mathcal{M}_{A} - \{j\}} \phi^{(j', A_j)}\)</span>, that is, <span class="math inline">\(j' \in \{1\}-\{1\}\)</span>, is empty. In this
case, the product is taken = 1, and <span class="math inline">\(V(\phi_A) = V(\psi_{1})\)</span>. That makes
intuitive sense, because, as noted previously, <span class="math inline">\(\phi_A = 1 - \psi_{1}\)</span>.</p>
<p>Proceeding with <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span>, <span class="math inline">\(\mathcal{M}_B = \mathcal{M}_C = \{1, 2\}\)</span>.
Consequently, each product <span class="math inline">\(\prod_{j' \in
\mathcal{M}_{B} - \{j\}} \psi_{j', B_j}\)</span> and <span class="math inline">\(\prod_{j' \in \mathcal{M}_{C} - \{j\}}
\psi_{j', C_j}\)</span> has only one term, for <span class="math inline">\(j' = 2\)</span> in the case of <span class="math inline">\(B\)</span> or <span class="math inline">\(j' =
1\)</span> in the case of <span class="math inline">\(C\)</span>: <span class="math display">\[\begin{align*}
    V(\phi_B) &amp;= \psi_{2, B_2} V(\psi_{1}) + \psi_{1,
B_1}  V(\psi_{2}) \\
    &amp;= (1 - \psi_{2}) V(\psi_{1}) + \psi_{1} V(\psi_{2}) \\
    V(\phi_C) &amp;= \psi_{2, C_2} V(\psi_{1}) + \psi_{1,
C_1}  V(\psi_{2}) \\
    &amp;= \psi_{2} V(\psi_{1}) + \psi_{1} V(\psi_{2}) \\
\end{align*}\]</span></p>
<p>Yet another application of the delta method produces approximate
variances for the individual-category logits. The relevant derivative is
<span class="math display">\[\begin{equation*}
\frac{d\Lambda_k}{d\phi_k} = \frac{1}{\phi_k(1 - \phi_k)}
\end{equation*}\]</span> for <span class="math inline">\(k = 1, \ldots,
m\)</span>, and so <span class="math display">\[\begin{align*}
V(\Lambda_k) &amp;\approx \left( \frac{d\Lambda_k}{d\phi_k} \right)^2
V(\phi_k) \\
&amp;= \left[ \frac{1}{\phi_k(1 - \phi_k)} \right]^2 V(\phi_k)
\end{align*}\]</span></p>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgment">Acknowledgment<a class="anchor" aria-label="anchor" href="#acknowledgment"></a>
</h2>
<p>I’m grateful to Georges Monette of York University for a close
reading of an earlier version of this document, and in particular for
his suggested simplification of the notation employed.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Fox:2021:Primer" class="csl-entry">
Fox, J. (2021). <em>A mathematical primer for social statistics</em>
(Second edition). Thousand Oaks <span>CA</span>: Sage. Retrieved from <a href="https://www.john-fox.ca/MathPrimer/index.html" class="external-link">https://www.john-fox.ca/MathPrimer/index.html</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John Fox, Michael Friendly.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
